extends ../head

append js
	script(src='/js/vendor/toastr.js')
	script(src='/js/proposalsview.js')

append css
	link(rel='stylesheet', href='/css/proposalview.css')

block content
	.container
		h2.title= proposal.ProposalTitle
		p.subtitle In #{categories[proposal.Category].name}
		if proposal.Status == 0
			p.draft-alert This is a draft proposal, and has not been submitted yet. Information is subject to change.
		.row
			.col-sm-12.col-md-4
				h3 Basic Info
				table.basic
					tbody
						tr
							th Proposal ID
							td= proposal.id
						tr
							th Created
							td= created
						tr
							th Department
							td= proposal.Department
						tr
							th Fund Status
							td= proposal.Status
						tr
							th Metrics
							td: a(href='/metrics/#{proposal.id}') View Metrics

			.col-sm-12.col-md-8
				h3 Contact Info
				.row.contacts
					.col-xs-12.col-sm-6.col-md-6
						table
							tbody
								th.contactType Primary
								tr
									th Name
									td= proposal.PrimaryName
								tr
									th Title
									td= proposal.PrimaryTitle
								tr
									th Phone
									td= proposal.PrimaryPhone
								tr
									th Email
									td= proposal.PrimaryEmail
								tr
									th Mailbox
									td= proposal.PrimaryMail
					.col-xs-12.col-sm-6.col-md-6
						table
							tbody
								th.contactType Budget
								tr
									th Name
									td= proposal.BudgetName
								tr
									th Title
									td= proposal.BudgetTitle
								tr
									th Phone
									td= proposal.BudgetPhone
								tr
									th Email
									td= proposal.BudgetEmail
								tr
									th Mailbox
									td= proposal.BudgetMail
					.col-xs-12.col-sm-6.col-md-6
						table
							tbody
								th.contactType Dean
								tr
									th Name
									td= proposal.DeanName
								tr
									th Title
									td= proposal.DeanTitle
								tr
									th Phone
									td= proposal.DeanPhone
								tr
									th Email
									td= proposal.DeanEmail
								tr
									th Mailbox
									td= proposal.DeanMail
					.col-xs-12.col-sm-6.col-md-6
						table
							tbody
								th.contactType Student
								tr
									th Name
									td= proposal.StudentName
								tr
									th Title
									td= proposal.StudentTitle
								tr
									th Phone
									td= proposal.StudentPhone
								tr
									th Email
									td= proposal.StudentEmail
								tr
									th Mailbox
									td= proposal.StudentMail
		h3 Abstract
		p= proposal.Abstract
		h3 Background
		p= proposal.Background
		h3 Category Justification
		p= proposal.CategoryJustification
		h3 Benefits to Students and University
		p= proposal.Benefits
		h3.title Access Restrictions
		p.subtitle Access available #{proposal.Days} between #{proposal.Hours}
		p= proposal.AccessRestrictions
		
		h3 Student Endorsements
		if endorsements
			each endorsement in endorsements
				.endorsement
					-var date = new Date(endorsement.createdAt);
					h4= endorsement.Name + " (" + endorsement.NetId + ") on " + (date.getMonth() + 1) + "/" + date.getDate()
					p= endorsement.Message
		else 
			p There are no endorsements for this proposal
		a(href="/proposals/endorsements/#{proposal.id}") Write an endorsement

		h3 Items
		if editor
			p.
				As an editor for this proposal, you may change the items below to reflect changes to prices, quantity,
				or specific item. It's a good idea to not change your proposal too much from its original purpose.

		if partials.length > 0
			| Partials 
			select#partial
				option(id='0' value='') Original Proposal Items 
				each partial in partials
					option(id='#{partial.id}' value='') #{users[partial.AuthorId].NetId + ': ' + partial.Title} 

		input(id='proposalId' type='hidden' value='#{proposal.id}' )
		if loggedIn
			a(href='/partials/new/#{proposal.id}' id='partialLink') Create Partial

		-var total = 0;
		table.items
			tbody
				tr.item-head
					th Item
					th Group
					th Unit Price
					th Quantity
					th Subtotal


				.default

					each item in items
						if item.PartialId === null
							+item(item, '', 0)
					+total('', 0)


				each partial in partials
					- total = 0;
						each item in items
							if item.PartialId == partial.id
								+item(item, 'hidden', partial.id)
						+total('hidden', partial.id)

						


mixin total(display, num)
	tr.item-head(class='#{display} #{num} items-js')
		td: h3 Summary
		td 
		td 
		td 
		td Total
	tr.item-head(class='#{display} #{num} items-js')
		td
		td
		td
		td
		td= "$" + total

mixin item(item, display, num)
	tr.item-info.info-first-line(class='#{display} #{num} items-js')
		if editor
			td <h4>#{item.ItemName}</h4> (<a href='/item/#{item.id}'>edit</a>)		
		else
			td: h4= item.ItemName
		td= item.Group
		td= "$" + item.Price
		td= item.Quantity
		td= "$" + item.Price * item.Quantity
	tr.item-info(class='#{display} #{num} items-js')
		td(colspan='5')
			span Description: 
			| #{item.Description}
	tr.item-info.info-last-line(class='#{display} #{num} items-js')
		td(colspan='5')
			span Justification: 
			| #{item.Justification}

	-total+= item.Price * item.Quantity;